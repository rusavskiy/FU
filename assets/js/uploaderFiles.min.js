var CSPR={objListRecordNameFileSaveDB:{},objListRecordNameFileLoadedLast:{},UploaderFile:function(q){var a={},g=function(f){a.flag.debug&&console.log(f)},d=function(f){a.flag.debug&&$().toastmessage("showToast",{text:f,position:"top-right",type:"notice",stayTime:6E3,inEffectDuration:200})},m=function(f){a.flag.debug&&$().toastmessage("showToast",{text:f,position:"top-right",type:"error",sticky:!0,inEffectDuration:200})},n=function(a){$().toastmessage("showToast",{text:a,position:"top-right",type:"error",
sticky:!1,stayTime:5E3,inEffectDuration:200})},p=function(a){$().toastmessage("showToast",{text:a,position:"top-right",type:"success",sticky:!1,inEffectDuration:200})},k=function(a){if(a){if(0===a.status)return a.message_debug&&m(a.message_debug),a.message&&n(a.message),!1;a.message_debug&&p(a.message_debug);a.message&&p(a.message);return!0}return!1};(function(){$.extend(a,q);if(a.objJQury)for(var d in a.objJQury)a[d]=$(a.objJQury[d])})();return{UploadOneFile:function(){var f=function(b){b?a.infoSize.text("\u0420\u0430\u0437\u043c\u0435\u0440: "+
b+" \u041a\u0431"):a.infoSize.text("")},h=function(){var b=a.id_listNameFilesStore.attr("id").replace(/[^\d]+/,"");void 0===CSPR.objListRecordNameFileSaveDB[b]&&(CSPR.objListRecordNameFileSaveDB[b]=a.id_listNameFilesStore.val());g("objListRecordNameFileSaveDB => ");g(CSPR.objListRecordNameFileSaveDB)},l=function(){a.fileInput.damnUploader("cancelAll");a.blokProgress.attr({style:""});a.loading.attr({style:""});a.progressBar.attr({style:""}).children().text("0%");a.fancybox_img.attr({title:"",href:""}).hide();
a.fancybox_img.nextAll("a").remove();a.fancybox_elements.empty();a.fileImg.attr({src:"",alt:""}).hide();a.linkFile.attr({href:""}).parent().hide();a.recordName.val("");a.id_listNameFilesStore.val("");a.nameFile.parent().hide();f("");a.nameFile.text("");a.getimagesizeFile.text("");a.buttonUpload.removeAttr("disabled");a.buttonEdit.hide();a.buttonDelete.hide();a.textBox.show()},r=function(b){var e={};h();l();a.textBox.hide();a.buttonUpload.attr("disabled",!0);a.blokProgress.show();b.size>a.max_size&&
alert("\u041f\u0440\u0435\u0432\u044b\u0448\u0435\u043d\u0438\u0435 \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e\u0433\u043e \u0440\u0430\u0437\u043c\u0435\u0440\u0430.\n\r \u0424\u0430\u0439\u043b - "+b.name+"\n\r \u0420\u0430\u0437\u043c\u0435\u0440\u043e\u043c - "+b.size+" Kb\n\r \u0414\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e - "+a.max_size+" Kb");b.fake?d("\u0424\u0430\u0439\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d: "+b.name):b.type.match(/image.*/)?d("\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0430 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0430: `"+
b.name+"` ("+Math.round(b.size/1024)+" \u041a\u0431)"):d("\u0424\u0430\u0439\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d: `"+b.name+"` (\u0442\u0438\u043f "+b.type+")");e={file:b,onProgress:function(b){a.progressBar.css("width",b+"%").children().text(b+"%");100!==b||a.loading.show()},onComplete:function(b,c,e){c&&(c=JSON.parse(c));g("\n\u0406\u043d\u0444\u0430 \u044f\u043a\u0443 \u0432\u0435\u0440\u0442\u0430\u0454 \u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u0456\u0441\u043b\u044f \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u0444\u0430\u0439\u043b\u0430:");
g(c);if(b&&c.nameFile){if(!k(c))return c.code_error&&l(),!1;c.listNameFilesStore&&(a.id_listNameFilesStore.val(c.listNameFilesStore),b=c.listNameFilesStore,e=a.recordName.attr("id").replace(/[^\d]+/,""),CSPR.objListRecordNameFileLoadedLast[e]=b,g("objListRecordNameFileLoadedLast => "),g(CSPR.objListRecordNameFileLoadedLast));c.nameFile&&(a.nameFile.text(c.nameFile).show(),a.recordName.val(c.nameFile));c.filesize&&f(c.filesize);c.getimagesize&&a.getimagesizeFile.text(c.getimagesize);a.blokProgress.hide();
if(a.flag.isImage){if(a.flag.fancybox&&a.fileImg.parent()&&c.listNameFilesStore){b=JSON.parse(c.listNameFilesStore);e=!1;for(var h in b)"original"!==h&&(!1===e?(e=!0,a.fileImg.attr("src",c.baseUrl+b[h]).show().parent().attr("href",c.baseUrl+b[h]).attr("title",c.nameFile).show()):$("<a/>").attr("href",c.baseUrl+b[h]).attr("title",c.nameFile).attr("data-fancybox-group",a.fileImg.parent().attr("data-fancybox-group")).addClass("U_fancybox_img").appendTo(a.fancybox_elements))}else a.fileImg.attr("src",
c.src).show();a.flag.editor&&a.buttonEdit.show()}else a.linkFile.attr("href",c.src).parent().show();a.buttonUpload.removeAttr("disabled");a.buttonDelete.show();a.nameFile.parent().show();d("\u0424\u0430\u0439\u043b `"+this.file.name+"` \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d, \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435:"+c)}else if(l(),n("\u0424\u0430\u0439\u043b `"+this.file.name+"`: \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435. \u041a\u043e\u0434: "+
e),!k(c))return!1}};a.fileInput.damnUploader("addItem",e)},e=function(){if(confirm("\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f?")){var b=[];b.push(a.id_listNameFilesStore.val());b.length&&$.ajax({url:a.urlDeleteFile,type:"post",data:{arrayDeleteFile:b},dataType:"json",async:!0,cache:!1,ifModified:!1,processData:!0,success:function(a){l();if(!k(a))return!1}})}return!1},s=function(){a.dropBox.bind({dragenter:function(){return!1},
dragover:function(){return!1},dragleave:function(){return!1}})};$(document).ready(function(){a.fileImg&&void 0!==a.fileImg.attr("src")&&(a.dropBox.width()&&a.fileImg.css("max-width",a.dropBox.width()),a.dropBox.height()&&a.fileImg.css("max-height",a.dropBox.height()),""!==a.fileImg.attr("src")&&a.fileImg.show());"function"===typeof a.fileInput.damnUploader?a.fileInput.damnUploader({url:a.upload.url,dataClient:a.upload.dataClient,fieldName:a.upload.fieldName,multiple:!1,dropBox:a.dropBox,limit:1,
limitAdditionComplete:!0,onLimitExceeded:function(){d("\u0414\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e\u0435 \u043a\u043e\u043b-\u0432\u043e \u0444\u0430\u0439\u043b\u043e\u0432 \u0443\u0436\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e");return!1},onSelect:function(a){r(a);return!1},onAdditionComplete:function(){d(" \u0432\u0441\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u044b\u0435 \u0444\u0430\u0439\u043b\u044b \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u044b\u0435 \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438  \n\r");
d("\n\r \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \n\r");a.fileInput.damnUploader("startUpload");return!1},onAllComplete:function(a){d("\n\r \u0412\u0441\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u044b! \n\r");return!1}}):m("\u041d\u0415 \u0421\u0423\u0429\u0415\u0421\u0422\u0412\u0423\u0415\u0422 damnUploader !!!");d(" \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438 ");$.support.fileSelecting?
($.support.fileReading||d("* \u0412\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043d\u0435 \u0443\u043c\u0435\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0444\u0430\u0439\u043b\u043e\u0432 (\u043c\u0438\u043d\u0438\u0430\u0442\u044e\u0440\u043a\u0438 \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u044b)"),$.support.uploadControl||d("* \u0412\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043d\u0435 \u0443\u043c\u0435\u0435\u0442 \u0441\u043b\u0435\u0434\u0438\u0442\u044c \u0437\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 (progressbar \u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442)"),
$.support.fileSending||d("* \u0412\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u043e\u0431\u044a\u0435\u043a\u0442 FormData (\u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0441 \u0440\u0443\u0447\u043d\u043e\u0439 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u043a\u043e\u0439 \u0437\u0430\u043f\u0440\u043e\u0441\u0430)"),d("\u0412\u044b\u0431\u043e\u0440 \u0444\u0430\u0439\u043b\u043e\u0432 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f\n\r")):
d("\u0412\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0432\u044b\u0431\u043e\u0440 \u0444\u0430\u0439\u043b\u043e\u0432 (\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0431\u0443\u0434\u0435\u0442 \u043e\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043b\u0435\u043d\u0430 \u043e\u0431\u044b\u0447\u043d\u043e\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u043e\u0439 \u0444\u043e\u0440\u043c\u044b)");
s();a.buttonUpload.on("click",function(){a.fileInput.click()});a.buttonDelete.on("click",function(){e()})})},InterceptionSubmitGarbageRemoval:function(){var d=function(){var d=0,f=[],g=[];if(0<Object.keys(CSPR.objListRecordNameFileLoadedLast).length){for(var e in CSPR.objListRecordNameFileLoadedLast)f.push(CSPR.objListRecordNameFileLoadedLast[e]);$.ajax({url:a.urlDeleteTempFiles,type:"post",data:{list:f},dataType:"json",async:!0,cache:!1,success:function(a){k(a)||(d=1)}});if(1===d)return!1;if(0<Object.keys(CSPR.objListRecordNameFileSaveDB).length){for(e in CSPR.objListRecordNameFileSaveDB)g.push(CSPR.objListRecordNameFileSaveDB[e]);
$.ajax({url:a.urlDeleteFile,type:"post",data:{arrayDeleteFile:g},dataType:"json",async:!1,cache:!1,success:function(a){CSPR.objListRecordNameFileSaveDB={}}})}}};$(document).ready(function(){a.listNameFilesStore.parents("form").submit(function(){d()});a.listNameFilesStore.parents("form").ajaxStart(function(){d()})})}}}};